<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tin Helm Web</title>
    <link rel="stylesheet" href="style.css">
    <!-- React and ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script>
      // If React is available, define a React modal root and fallback logic
      window.ReactAvailable = typeof React !== 'undefined' && typeof ReactDOM !== 'undefined';
    </script>
    <!-- Anime.js for animations (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" id="animejs-cdn"></script>
    <script>
      // Wait for Anime.js to load before running main.js
      function runMainWhenAnimeReady() {
        if (window.anime) {
          import('./scripts/main.js');
        } else {
          setTimeout(runMainWhenAnimeReady, 30);
        }
      }
      runMainWhenAnimeReady();
    </script>
</head>
<body>
    <header>Tin Helm Web UI</header>
    <div class="layout">
        <div class="area1">
            <div id="sandwich-menu">
                <div class="sandwich-icon" onclick="document.getElementById('sandwich-dropdown').style.display = (document.getElementById('sandwich-dropdown').style.display === 'block' ? 'none' : 'block')">
                    <div class="sandwich-bar"></div>
                    <div class="sandwich-bar"></div>
                    <div class="sandwich-bar"></div>
                </div>
                <div id="sandwich-dropdown">
                    <button id="save-btn">Save Game</button>
                    <button id="load-btn">Load Game</button>
                </div>
            </div>

            <header id="player-stats">
                <div class="stat" id="stat-hp">HP: <span class="value" id="hp-value">10</span></div>
                <div class="stat" id="stat-energy">Energy: <span class="value" id="energy-value">5</span></div>
                <div class="stat" id="stat-food">Food: <span class="value" id="food-value">2</span></div>
                <div class="stat" id="stat-favor">Favor: <span class="value" id="favor-value">0</span></div>
                <div class="stat" id="stat-level">Level: <span class="value" id="level-value">1</span></div>
                <div class="stat" id="stat-shards">Shards: <span class="value" id="shards-value">0</span></div>
            </header>

            <div id="character-creation">
                <div class="selection-container">
                    <label for="race-select">Choose your Race:</label>
                    <select id="race-select">
                        <option value="">--Please choose a race--</option>
                    </select>
                </div>
                <div class="selection-container">
                    <label for="class-select">Choose your Class:</label>
                    <select id="class-select">
                        <option value="">--Please choose a class--</option>
                    </select>
                </div>
            </div >

             <button id="start-game-btn">Start Game</button>

            <div id="trackers-col">
              <div class="tracker-card-wrapper" id="tracker-hp-wrapper">
                <img class="tracker-card" id="tracker-hp" src="assets/cards/tracker/Tracker_HP.png" alt="Tracker HP">
                <div class="tracker-cube hp" id="cube-hp"></div>
              </div>
              <div class="tracker-card-wrapper" id="tracker-en-ration-wrapper">
                <img class="tracker-card" id="tracker-en-ration" src="assets/cards/tracker/Tracker_EN_Ration.png" alt="Tracker EN/Ration">
                <div class="tracker-cube energy" id="cube-energy"></div>
                <div class="tracker-cube rations" id="cube-rations"></div>
              </div>
              <div class="tracker-card-wrapper" id="tracker-favor-wrapper">
                <img class="tracker-card" id="tracker-favor" src="assets/cards/tracker/Tracker_Favor.png" alt="Tracker Favor">
                <div class="tracker-cube favor" id="cube-favor"></div>
              </div>
              <div class="tracker-card-wrapper" id="tracker-enemyhp-dungeonlevel-wrapper">
                <img class="tracker-card" id="tracker-enemyhp-dungeonlevel" src="assets/cards/tracker/Tracker_EnemyHP_DungeonLevel.png" alt="Tracker EnemyHP/DungeonLevel">
                <div class="tracker-cube dungeon" id="cube-dungeon"></div>
                <div class="tracker-cube enemy" id="cube-enemy"></div>
              </div>
            </div>
            <div id="player-area-row">
              <div id="player-cards-col">
                <div id="player-cards-row">
                  <div id="race-card-display" class="card">
                    <img id="race-card-image" alt="Race Card">
                  </div>
                  <div id="class-card-display" class="card">
                    <img id="class-card-image" alt="Class Card">
                  </div>
                </div>
                <div id="inventory-section"></div>
              </div>
            </div>
            <div class="vertical-ruler"></div>
        </div>
        <div class="area2">
            <div class="dungeon-area">
                <div class="dungeon-row" style="flex-wrap: nowrap;">
                    <div class="card-slot" id="slot-deck">Deck</div>
                    <div class="card-slot" id="slot-room">Room</div>
                    <div class="card-slot" id="slot-result">Result</div>
                    <div class="card-slot" id="slot-discard">Discard</div>
                </div>
            </div>
            <div class="encounter-area">
                Encounter Area (e.g., Enemies, Reference Cards, Dice, Options)
            </div>
            <div id="combat-area"></div>
            <div id="room-decision-buttons" style="display: none;">
                <button id="resolve-button">Resolve</button>
                <button id="skip-button">Skip</button>
            </div>
            <button id="next-room-btn" style="display:none; margin-top:1em;">Next Room</button>

            <div id="session-log" style="height: 120px; overflow-y: auto; background: #222; color: #fff; font-size: 0.95em; padding: 0.5em; margin-top: 1em; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <!-- Session log will appear here -->
            </div>

            <div id="endgame-message" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%,-50%); background:#fff; border:2px solid #333; padding:2rem; z-index:100; text-align:center; font-size:1.2rem; box-shadow:0 4px 16px rgba(0,0,0,0.2);">
                <span id="endgame-text"></span>
                <br><br>
                <button onclick="location.reload()">Restart</button>
            </div>
        </div>
    </div>

    <!-- Character Selection Modal (hidden by default, injected by JS) -->
    <div id="character-modal-root"></div>

    <!-- Card Zoom Overlay (reusable for any card) -->
    <div id="card-zoom-overlay" style="display:none;">
      <img id="card-zoom-img" src="" alt="Card Zoom" />
    </div>

    <script src="scripts/main.js" type="module"></script>
    <footer>&copy; 2025 Tin Helm Web</footer>
</body>
</html>
